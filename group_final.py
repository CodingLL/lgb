import json

import pandas as pd
import tldextract
from pymongo import MongoClient
from tqdm import tqdm
import requests


# with open("kpe_verify/verify_predicates_training.jsonl", "r") as fr:
#     lines = fr.readlines()


def get_source_profile():
    return MongoClient(
        'mongodb://rs-crawler.mongo.nb.com:27017/?replicaSet=rs-crawler&readPreference=secondaryPreferred')[
        'spider_v2']['domain_profile_weekly']


def get_source_source():
    return MongoClient(
        'mongodb://rs-crawler.mongo.nb.com:27017/?replicaSet=rs-crawler&readPreference=secondaryPreferred')[
        'source']['source']


def get_document_from_id(collection, id, fields):
    if fields is None:
        documents = collection.find({'_id': id})
    else:
        db_filter = {f: 1 for f in fields}
        documents = collection.find({'_id': id}, db_filter)
    for r in documents:
        return r
    return None


def get_mediabias_report(source):
    col = get_source_profile()
    doc = get_document_from_id(col, source, ['mediabias_report'])
    if doc is None:
        return 'unknown', 'unknown'
    mediabias_report = doc.get('mediabias_report', {})
    factual_reporting = mediabias_report.get('factual_reporting', "unknown")
    mbfc_credibility_rating = doc.get('mbfc_credibility_rating', "unknown")
    return factual_reporting, mbfc_credibility_rating


def get_source_quality(domain):
    col_source_source = get_source_source()
    doc = get_document_from_id(col_source_source, domain, ['full_code', 'media_quality'])
    if doc is None:
        return '', ''
    return doc.get('full_code', ''), doc.get('media_quality', '')
    
    
def get_features(references: list):
    claim_estimations = [c for c in references if c["relevant"]]
    claim_list = []

    for c in claim_estimations:
        relevant = c["relevant"]
        if relevant:
            support_or_negate = c["support_or_negate_or_baseless"]
            confidence = c["confidence"]
            url = c["url"]
            extracted = tldextract.extract(url)
            domain = f"{extracted.domain}.{extracted.suffix}"
            factual_reporting, mbfc_credibility_rating = get_mediabias_report(domain)
            full_code, media_quality = get_source_quality(domain)

            claim_list.append({
                "domain": domain,
                "url": url,
                "factual_reporting": factual_reporting,
                "mbfc_credibility_rating": mbfc_credibility_rating,
                "full_code": full_code,
                "media_quality": media_quality,
                "support_or_negate": support_or_negate,
                "confidence": confidence,
                'same_news': c['same_news'],
                'relevant': relevant,
                "rationale": c["rationale"]
            })
    # print([c["support_or_negate"] for c in claim_list])
    # print([(c["support_or_negate"], c["url"], c["rationale"]) for c in claim_list])
    print(claim_list)

    features = {'claim_estimations': claim_list,
                'predicate_estimations': []}
    return features

    

if __name__ == '__main__':
    # input = {
    #     "title": "Mayor TELLS Muslim Refugees: \u00e2\u0080\u0098We Don\u00e2\u0080\u0099t Adapt To Your Culture, You Adapt To Ours\u00e2\u0080\u0099", "text": "(Via JewsNews) Quebec mayor gives Muslim \u00e2\u0080\u0098refugees\u00e2\u0080\u0099 a little piece of his mind by spilling the truth that Canadians don\u00e2\u0080\u0099t adapt to them, it\u00e2\u0080\u0099s the other way around.  \u00e2\u0080\u009d MUSLIMS MUST UNDERSTAND THAT THEY MUST ADAPT TO CANADA, ITS CUSTOMS, ITS TRADITIONS, ITS WAY OF LIFE, BECAUSE IT WAS THE COUNTRY THAT WAS CHOSEN TO EMIGRATE. YOU HAVE TO UNDERSTAND THAT THEY ARE THE ONES THAT THEY MUST INTEGRATE AND LEARN TO LIVE IN CANADA. NEED TO UNDERSTAND THAT THEY HAVE TO BE FOR THEM TO CHANGE THEIR LIFESTYLE, NOT THE CANADIANS WHO SO GENEROUSLY WELCOMED THEM. YOU MUST UNDERSTAND THAT CANADIANS ARE NOT RACIST OR XENOPHOBIC. WE ACCEPT MANY IMMIGRANTS, IN MANY COUNTRIES WITH DIFFERENT CULTURES AND RELIGIONS, CONTRADICTING TO MANY MUSLIM COUNTRIES WHICH DO NOT ACCEPT IMMIGRANTS NON-MUSLIMS. FOR THIS REASON, THE CANADIANS ARE NOT WILLING TO GIVE UP THEIR IDENTITY AND THEIR CULTURE. FINALLY, THEY HAVE TO UNDERSTAND THAT IN CANADA, WITH ITS JUDEO-CHRISTIAN ROOTS, CHRISTMAS TREES, CHURCHES AND RELIGIOUS FESTIVALS, RELIGION MUST REMAIN IN THE PRIVATE SPHERE. THE MUNICIPALITY OF DURVAL HAS THE RIGHT TO REFUSE ANY CONCESSIONS TO ISLAM AND SHARIA LAW. FOR MUSLIMS, WHO ARE NOT IN AGREEMENT WITH THE CANADIAN CULTURE AND RELIGION AND DO NOT FEEL COMFORTABLE IN CANADA, THERE ARE 57 BEAUTIFUL MUSLIM COUNTRIES IN THE WORLD, MOST OF THEM UNDER-POPULATED AND READY TO RECEIVE THEM WITH OPEN ARMS, IN ACCORDANCE WITH SHARIA LAW. IF YOU LEFT HIS COUNTRY TO COME TO CANADA, AND NOT TO A MUSLIM COUNTRY, IT IS BECAUSE YOU HAVE CONSIDERED THAT LIFE IS BETTER IN CANADA THAN IN OTHER PLACES. HELP YOURSELF TO THE QUESTION, JUST ONCE: WHY IS IT BETTER HERE IN CANADA THAT WHERE IT COMES FROM. It boggles my mind that many feel that they have the right or the authority to control other peoples lives. This is the direct opposite of what we feel as humans. Because Muslims cannot eat a particular meal, should mean they should bring their own. The few should never out weigh the many, especially when it comes to adopted culture. Adopt it, or don\u2019t. Just do block others from it. Gernot Trolf Mar 28, 2016 at 1:12 pm The Prime Minister of Australia said much the same and I agree with you both wholeheartedly. Spread the word. Adapt or leave", "main claim": "The Quebec mayor asserts that Muslim refugees must adapt to Canadian customs, traditions, and way of life, rather than expecting Canada to adapt to theirs.", "references": [{"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result provided does not contain any information regarding the mayor's statements or positions on Muslim refugees adapting to Canadian customs, traditions, and way of life. It only mentions that the Dorval, Quebec mayor did not insult the Muslim community, without providing details on the mayor's views or statements related to the claim. Therefore, there is no basis to support or negate the claim based on the given search result.", "url": "https://www.reuters.com/article/idUSL1N2OO1CI/", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result contains a detailed account of a letter allegedly sent by the mayor of a Montreal suburb to Muslim parents, which explicitly states that Muslims must adapt to Canadian customs, traditions, and way of life, rather than expecting Canada to adapt to theirs. This directly supports the claim, despite the overall story being identified as a hoax. The detailed narrative provided in the search result, which aligns with the claim, allows for a high confidence rating.", "url": "https://mykisscountry937.com/letter-to-muslims-from-mayor-in-quebec-isnt-true/", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result explicitly states that the mayor of the Montreal suburb of Dorval refused to abolish pork in school canteens following demands from Muslim 'refugees'. It further includes a note explaining that Muslims must adapt to Canada and Quebec, its customs, traditions, and way of life, emphasizing the need for integration and adaptation to the Canadian way of life rather than expecting Canada to adapt to theirs. This directly supports the claim that the Quebec mayor asserts Muslim refugees must adapt to Canadian customs, traditions, and way of life.", "url": "https://www.linkedin.com/pulse/quebec-mayor-muslim-refugees-we-dont-adapt-your-culture-lucena", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The content of the search result explicitly states that the Mayor of Dorval, Quebec, responded to Muslim parents' demands regarding the abolition of pork in school canteens by refusing to do so. The mayor's response, as detailed in the search result, emphasizes that Muslims must adapt to Canada and Quebec's customs, traditions, and way of life, highlighting the expectation for immigrants to integrate and learn to live in Quebec rather than expecting Canadians to change their lifestyle to accommodate new arrivals. This directly supports the claim that the Quebec mayor asserts Muslim refugees must adapt to Canadian customs, traditions, and way of life, rather than expecting Canada to adapt to theirs.", "url": "https://www.nairaland.com/2018646/mayor-dorval-quebec-canada-responded", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result directly quotes a statement attributed to the mayor, which emphasizes that Muslims should adapt to Canada and Quebec's customs, traditions, and way of life. This aligns with the claim that the mayor asserts Muslim refugees must adapt to Canadian customs, traditions, and way of life, rather than expecting Canada to adapt to theirs.", "url": "https://www.reuters.com/article/idUSL1N2OO1CI/#:~:text=The%20text%20reads%2C%20in%20part,all%20school%20canteen%20in%20Montreal", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The content of the search result explicitly states that the mayor of the Montreal suburb of Dorval refused to remove pork from school canteen menus in response to demands from Muslim parents, and communicated to all parents explaining that Muslims must adapt to Canada and Quebec's customs, traditions, and way of life. This directly supports the claim that the Quebec mayor asserts Muslim refugees must adapt to Canadian customs, traditions, and way of life, rather than expecting Canada to adapt to theirs.", "url": "https://www.linkedin.com/pulse/story-said-hoaxbut-how-much-better-we-might-only-wilhite-sphr-cac?trk=article-ssr-frontend-pulse_more-articles_related-content-card", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result discusses a hoax involving a supposed letter from the mayor of Dorval, Quebec, instructing Muslim residents to adapt to Canadian customs and traditions, specifically regarding the removal of pork from school menus. However, the article clarifies that this story is a fabrication and has been debunked multiple times. The City of Dorval and its mayor have publicly denied making such comments, indicating that the claim about the Quebec mayor's assertion is based on a false premise. Therefore, since the claim originates from a hoax, there is no factual basis to support or negate the assertion that the Quebec mayor made such a statement.", "url": "https://www.buzzfeed.com/ishmaeldaro/dorval-mayor-pork-letter-hoax", "same_news": False, "relevant": True}]}

    # input = {"title": "Bombing Suspect Filed Anti-Muslim Discrimination Lawsuit Against Police", "text": "From the Daily Caller News Foundation: The man arrested Monday in connection with the New York City bombing sued his local police force over anti-Muslim discrimination claims. Ahmad Khan Rahami filed the lawsuit against cops in Elizabeth, N.J., where he was residing before he\u00a0planted bombs\u00a0in the Chelsea neighborhood of Manhattan, at a train station in Elizabeth, and on the route of a 5k Marine charity run on the Jersey shore. He claimed police were persecuting him for being a Muslim and subjecting him and his family to \u201cselective enforcement\u201d based on Islam,\u00a0reports\u00a0The Daily Mail. Rahami worked at a chicken restaurant called First American, owned by his family, who claimed the police tried to shut it down early each night with \u201cbaseless\u201d tickets, and that locals said: \u201cMuslims don\u2019t belong here.\u201d Rahami brought the suit along with his father Mohammad Sr. and his brother Mohammad. He was arrested following a shootout with police Monday, after he was found passed out in the doorway of a New Jersey bar.  The views expressed in this opinion article are solely those of their author and are not necessarily either shared or endorsed by EagleRising.com Get your daily dose of Eagle Rising by entering your email address below.", "main claim": "The New York City bombing suspect, Ahmad Khan Rahami, had previously filed a lawsuit against his local police force in Elizabeth, N.J., claiming anti-Muslim discrimination.", "references": [{"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result explicitly states that the family of Ahmad Khan Rahami, who was arrested in connection with bombings, sued the city of Elizabeth in 2011, alleging a pattern of harassment and religious discrimination by city officials. This directly supports the claim that Ahmad Khan Rahami had previously filed a lawsuit against his local police force in Elizabeth, N.J., claiming anti-Muslim discrimination.", "url": "https://www.nj.com/news/2016/09/family_of_bombing_suspect_sued_elizabeth_for_discr.html", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result explicitly states that Ahmad Khan Rahami's family, which includes him, filed a lawsuit in 2011 against the city of Elizabeth, New Jersey, and its police department, alleging discrimination and harassment. This directly supports the claim that Ahmad Khan Rahami had previously filed a lawsuit against his local police force in Elizabeth, N.J., claiming anti-Muslim discrimination.", "url": "https://www.cnn.com/2016/09/19/us/ny-nj-bombing-suspect-rahami-muslim-discrimination/index.html", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result explicitly states that Ahmad Khan Rahami's family, who owns First American Fried Chicken in Elizabeth, NJ, filed a lawsuit against the city council, the mayor, police officers, and a neighbor, claiming they were subjected to discrimination for being Muslim. This directly supports the claim that Ahmad Khan Rahami had previously filed a lawsuit against his local police force in Elizabeth, N.J., claiming anti-Muslim discrimination.", "url": "https://lawandcrime.com/high-profile/bombing-suspect-ahmad-khan-rahamis-family-once-sued-mayor-and-police/", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result explicitly states that Ahmad Khan Rahami, along with his family, filed a lawsuit against police for discrimination and 'selective enforcement', claiming they were targeted for being Muslim. This directly supports the claim that Rahami had previously filed a lawsuit against his local police force in Elizabeth, N.J., claiming anti-Muslim discrimination. The lawsuit details include allegations of harassment and intimidation by the police, specifically mentioning attempts to shut down their family's chicken restaurant earlier than other similar businesses and racial abuse from residents. These details provide a strong basis for supporting the claim with high confidence.", "url": "https://www.independent.co.uk/news/world/americas/ahmad-khan-rahami-ny-nj-bombing-suspect-sued-police-muslim-chicken-shop-a7316801.html", "same_news": True, "relevant": True}, {"support_or_negate_or_baseless": "support", "confidence": "high", "rationale": "The search result explicitly states that Ahmad Khan Rahami's family, including himself, filed a lawsuit against the city of Elizabeth, N.J. and its police department, accusing them of discrimination and harassment. This lawsuit was in response to the city's handling of their local restaurant, First American Fried Chicken, and included allegations of being unfairly subjected to citations and harassment by an officer from the Elizabeth, N.J. police department. This directly supports the claim that Ahmad Khan Rahami had previously filed a lawsuit against his local police force in Elizabeth, N.J., claiming anti-Muslim discrimination.", "url": "https://thehill.com/blogs/blog-briefing-room/news/296687-bombing-suspects-family-accused-city-of-discrimination/", "same_news": True, "relevant": True}]}

    # input = {"title": "Republicans Push Bill To Legalize Voter Intimidation To Help Trump In Pennsylvania", "text": "Pennsylvania Republicans are trying to jam a bill through the statehouse that would go into effect immediately to allow voter intimidation across the state on Election Day in support of Donald Trump. First proposed in June, House Bill 29 would give outsiders the ability to watch the polls in districts in which they do not reside and would give them the power to challenge voters, which would disrupt the voting process and cause delays that could prevent people from exercising their right to vote. In other words, it would legalize voter intimidation. As Brennan Center for Justice counsel Adam Gitlin told earlier this month, poll watchers, especially those who decide they are going to challenge voters based on their race or religion, could throw a damaging wrench in the democratic process. \u00e2\u0080\u009cThere\u00e2\u0080\u0099s actually a risk that, in a more disorganized way, people are going to be showing up to the polls, they won\u00e2\u0080\u0099t know the law, and they\u00e2\u0080\u0099ll be engaging in discriminatory challenges,\u00e2\u0080\u009d Gitlin said. \u00e2\u0080\u009cThat can create the potential for a lot of disruption, longer lines because each voter takes longer to vote, and potentially discouraging and intimidating voters from coming to the polls.\u00e2\u0080\u009d As we all know, conservatives who support Trump are racists who think their brand of Christianity should be the law of the land, so it is likely they will challenge every black and Latino voter they see as well as any voter they think is a Muslim. And that\u00e2\u0080\u0099s exactly what Republican nominee Donald Trump wants. \u00e2\u0080\u009cWe\u00e2\u0080\u0099re going to watch Pennsylvania,\u00e2\u0080\u009d Trump declared during a rally in the state last month. \u00e2\u0080\u009cGo down to certain areas and watch and study and make sure other people don\u00e2\u0080\u0099t come in and vote five times. If you do that, we\u00e2\u0080\u0099re not going to lose. The only way we can lose, in my opinion \u00e2\u0080\u0093 I really mean this, Pennsylvania \u00e2\u0080\u0093 is if cheating goes on.\u00e2\u0080\u009d Trump even has a place on his website where his supporters can sign up to be poll watchers to \u00e2\u0080\u009cStop Crooked Hillary From Rigging This Election!\u00e2\u0080\u009d In response to Trump\u00e2\u0080\u0099s claim that the election will be rigged against him, Pennsylvania Republicans have tacked an amendment on the bill that would make it go into effect immediately if it is passed and signed by the governor. Originally, it was only going to go into effect 60 days after passage. With the polls showing a close race heading into the first debate, Pennsylvania is even more important now. But voter intimidation could tip the scales significantly in Trump\u00e2\u0080\u0099s favor and effect races down the ticket. In short, Trump and the Republicans are trying to steal the election by making a form of cheating completely legal. And if it works in Pennsylvania you can bet that Republicans will make sure such tactics are legalized everywhere else. ", "main claim": "Pennsylvania Republicans are advancing a bill that would allow voter intimidation to support Donald Trump by permitting poll watchers from outside districts to challenge voters, potentially disrupting the voting process and deterring voter participation.", "references": [{"support_or_negate_or_baseless": "support", "confidence": "medium", "rationale": "The search result mentions a bill recently proposed in the Pennsylvania state legislature that would allow voters to serve as poll watchers anywhere in the state, not just in their own counties as current law requires. State Rep. Brian Sims (D) warned that the bill\u2019s 'intent is to create a situation at polling locations that make voters uncomfortable.' Additionally, it mentions that state Republicans filed a complaint to allow poll watchers to cross county boundaries. This supports the claim that Pennsylvania Republicans are advancing a bill that could potentially disrupt the voting process and deter voter participation by permitting poll watchers from outside districts to challenge voters. However, the claim specifically mentioning support for Donald Trump and the intent to allow voter intimidation is not directly supported by the search result, leading to a medium confidence rating.", "url": "https://www.americanprogress.org/article/preventing-problems-at-the-polls-pennsylvania/", "same_news": true, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result does not provide specific information about a Pennsylvania bill related to poll watchers from outside districts or any legislation that explicitly allows voter intimidation to support Donald Trump. The content focuses on broader issues of voter intimidation and the involvement of certain groups and individuals in poll watching and challenging election outcomes, without mentioning specific Pennsylvania legislation. Therefore, the claim cannot be supported or negated based on the provided content.", "url": "https://www.vox.com/policy-and-politics/2022/10/30/23431048/poll-watchers-voting-intimidation", "same_news": false, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result focuses on the Trump campaign's instructions to poll watchers for the election, emphasizing the need for them to follow rules, not cause disruptions, and not to challenge every ballot. It mentions the campaign's efforts to train poll watchers properly and to ensure they do not engage in voter intimidation. However, the search result does not mention any specific bill being advanced by Pennsylvania Republicans related to allowing voter intimidation or permitting poll watchers from outside districts to challenge voters. Therefore, the content does not provide information to support or negate the claim about such a bill.", "url": "https://www.cbsnews.com/philadelphia/news/trump-campaigns-pennsylvania-training-tape-for-poll-watchers-tells-them-specifically-not-to-challenge-every-ballot/", "same_news": false, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The provided search result does not contain information regarding a Pennsylvania bill that would allow voter intimidation to support Donald Trump by permitting poll watchers from outside districts to challenge voters. The content focuses on the Republican National Committee's efforts to restrict mail voting in battleground states and does not discuss specific legislation related to poll watchers or voter intimidation in Pennsylvania. Therefore, the claim cannot be supported or negated based on the information in the search result.", "url": "https://ohiocapitaljournal.com/2024/02/23/gop-backs-voting-by-mail-yet-turns-to-courts-to-restrict-it-in-battleground-states/", "same_news": false, "relevant": true}, {"support_or_negate_or_baseless": "support", "confidence": "medium", "rationale": "The search result mentions that Texas passed a law empowering partisan poll watchers, requiring them to have 'free movement' in polling places and making it illegal to obstruct their view. While this does not directly mention Pennsylvania or a specific bill advancing there, it indicates a trend of laws being passed that could potentially increase the power of poll watchers in a way that might intimidate voters or disrupt the voting process. This supports the claim that there are legislative efforts which could allow for increased voter intimidation to support Donald Trump by permitting poll watchers from outside districts to challenge voters. However, the confidence level is medium because the specific details about Pennsylvania and the claim's focus on a bill advancing there are not directly addressed in the search result.", "url": "https://www.americanprogress.org/article/how-to-save-american-democracy/", "same_news": False, "relevant": True}]}

    # input = """
    # {"title": "Trump says Never Trumpers \u2018are dying, on respirators\u2019", "text": "The anti-Donald Trump movement is on its death bed, the Republican presidential nominee boasted on Wednesday. \u201cYou\u2019ll hear about these Never Trumpers, who are dying. Right now they\u2019re on respirators, OK,\u201d Trump said in response to a question about whether he will stand firm on his commitment to naming \u201ctrue constitutionalists\u201d to the Supreme Court. Story Continued Below Trump cited an \u201camazing\u201d Wall Street Journal report \u201cabout all of the support that we\u2019re getting.\u201d The real estate mogul appears to be referring to a story published online late Monday in which the Journal reported that billionaires Sheldon Adelson and Joe Ricketts plan to pump millions of dollars into Trump and a pro-Trump super PAC. \u201cFrom lots of rich people even,\u201d Trump said of the fresh support he\u2019s getting. \u201cThey\u2019re coming in. These were Never Trump, Never Trump, Never Trump and now they\u2019re \u2014 believe me, they see lower taxes, they see cutting the regulations, they see job creation, which is so important, and it\u2019s really been amazing.\u201d \u201cAnd one of the things that they see and that you people see,\u201d he told the group of pastors inside a Cleveland church, \u201cis that \u2014 and so important \u2014 the judges. So I picked 11 judges. Very, very much into the world of the Constitution because we have people that, in some cases, not \u2014 I think in all cases \u2014 will have absolutely no \u2014 the Constitution will have no bearing on their decisions, OK, if somebody else gets it. And we picked 11 and we\u2019re adding nine more. We\u2019re gonna have a total of 20 people and I will pick from that group of 20 people. These are 20 outstanding people.\u201d", "main claim": "Trump claims the Never Trump movement is nearly defeated, citing increased support from previously opposed wealthy individuals and emphasizing his commitment to appointing constitutionalists to the Supreme Court.", "references": [{"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result content does not provide any information regarding Trump's claim about the Never Trump movement being nearly defeated, increased support from previously opposed wealthy individuals, or his commitment to appointing constitutionalists to the Supreme Court. The content only mentions that big money failed to stop Trump, which does not directly address the specifics of the claim. Therefore, the claim cannot be supported or negated based on the provided search result.", "url": "https://www.reuters.com/world/us/big-money-fails-stop-trump-again-prompting-donor-reckoning-2024-01-26/", "same_news": true, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result content focuses on the Supreme Court's decisions regarding Donald Trump's legal challenges and does not provide information on the Never Trump movement, Trump's support from wealthy individuals, or his commitment to appointing constitutionalists to the Supreme Court. Therefore, it cannot support or negate the claim due to the lack of relevant information.", "url": "https://www.nbcnews.com/politics/donald-trump/trump-built-supreme-court-conservative-majority-loses-rcna131956", "same_news": false, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result primarily discusses Donald Trump's relationship with the Supreme Court, focusing on his appointments, the court's rulings on various cases involving him, and his criticisms of the court. It does not provide information on the Never Trump movement, Trump's claims of increased support from wealthy individuals previously opposed to him, or his commitment to appointing constitutionalists to the Supreme Court in the context of defeating the Never Trump movement. Therefore, the claim cannot be supported or negated based on the information provided in the search result.", "url": "https://www.usatoday.com/story/news/politics/elections/2024/02/05/trumps-track-record-supreme-court-colorado-ballot-case/72436172007/", "same_news": false, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result content focuses on the sentiment and perspectives of 'Never Trumpers' regarding the future of the GOP and Trump's influence within the party. It discusses the pessimism among conservatives opposed to Trump, his potential nomination for the GOP, and the challenges faced by his opponents within the party. However, it does not mention Trump's claims about the Never Trump movement being nearly defeated, nor does it discuss his support from wealthy individuals or his commitment to appointing constitutionalists to the Supreme Court. Therefore, the content cannot support or negate the claim due to the absence of relevant information.", "url": "https://thehill.com/homenews/campaign/4422789-the-memo-never-trumpers-are-close-to-giving-up-hope/", "same_news": false, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The search result does not provide information regarding Trump's claims about the Never Trump movement being nearly defeated, nor does it mention his citing increased support from previously opposed wealthy individuals or his commitment to appointing constitutionalists to the Supreme Court. Therefore, the content cannot support or negate the claim due to the absence of relevant information.", "url": "https://www.usatoday.com/story/news/politics/elections/2024/02/02/anti-donald-trump-republican-voting-options/72338501007/", "same_news": false, "relevant": true}, {"support_or_negate_or_baseless": "baseless", "confidence": "high", "rationale": "The provided search result content does not contain any information relevant to Trump's claim about the Never Trump movement, his increased support from previously opposed wealthy individuals, or his commitment to appointing constitutionalists to the Supreme Court. The search result only mentions the existence of Anti-Trump Republicans without providing any details that could be used to evaluate the claim.", "url": "https://www.politico.com/news/magazine/2023/12/08/the-stop-trump-effort-has-been-abysmal-00130751", "same_news": false, "relevant": true}]}
    # """
    # # input = input.replace('\\"', "'")
    # input = json.loads(input)
    # print(json.dumps(input, indent=2))
    # print(input.keys())
    service_url = 'http://172.31.28.251:7777/consolve_media_conflict'
    
    buzzfeed_data = []
    # filepath = '/home/services/siliang/fakenews/BuzzFeed-Webis_Fake_News_Corpus_2016/buzzfeed_1267.jsonl'
    filepath = '/home/services/siliang/NB-LLM/data_preparation/gpt_fake_news_detection/res/buzzfeed_1267_nbmodel.jsonl'
    filepath = '/home/services/siliang/NB-LLM/data_preparation/gpt_fake_news_detection/res/buzzfeed182_gpt.jsonl'
    filepath = '/home/services/siliang/NB-LLM/data_preparation/gpt_fake_news_detection/res/buzzfeed182_gpt_main_claim_only_0314.jsonl'
    filepath = '/home/services/siliang/NB-LLM/data_preparation/gpt_fake_news_detection/res/politifact_547_gpt_main_claim_only_0314.jsonl'
    model_name = 'gpt'
    with open(filepath) as f:
        for line in f:
            dic = json.loads(line)
            buzzfeed_data.append(dic)
    print('size of data: {}'.format(len(buzzfeed_data)))
    
    for dic in tqdm(buzzfeed_data):
        if 'features' in dic[model_name]:
            features = dic[model_name]['features']
            # continue
        else:
            features = get_features(dic[model_name]['overall_predictions'])
            # print(features)
        result = requests.post(service_url, json=features)
        # sprint(result.json())
        dic[model_name]['features'] = features
        dic[model_name]['final_prediction'] = result.json()
        
        
    # savepath = 'data/buzzfeed182_gpt_rerun_0314.jsonl'
    print(len(buzzfeed_data))
    savepath = '/home/services/siliang/ml_fakenews/data/politifact_547_gpt_main_claim_only_0315.jsonl'
    print('savepath: {}'.format(savepath))
    with open(savepath, 'w') as f:
        for dic in buzzfeed_data:
            f.write(json.dumps(dic) + '\n')